<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Melhorias WebSocket</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .connected {
            background-color: #4CAF50;
            color: white;
        }
        .disconnected {
            background-color: #f44336;
            color: white;
        }
        .log {
            background-color: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        .info {
            background-color: #2196F3;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Teste de Melhorias WebSocket</h1>
    
    <div class="info">
        <h3>Instruções de Teste:</h3>
        <ol>
            <li>Abra o Console do navegador (F12) para ver logs detalhados</li>
            <li>Teste mudar de aba e voltar - a conexão deve ser mantida</li>
            <li>Minimize a janela e restaure - a conexão deve ser mantida</li>
            <li>Desative a internet e reative - deve reconectar automaticamente</li>
            <li>Observe os pings sendo enviados a cada 15 segundos</li>
        </ol>
    </div>
    
    <div id="status" class="status disconnected">Desconectado</div>
    
    <div class="controls">
        <button onclick="testConnect()">Conectar</button>
        <button onclick="testDisconnect()">Desconectar</button>
        <button onclick="testSendMessage()">Enviar Mensagem Teste</button>
        <button onclick="clearLog()">Limpar Log</button>
    </div>
    
    <h3>Log de Eventos:</h3>
    <div id="log" class="log"></div>
    
    <script>
        let eventLog = [];
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            eventLog.push(logEntry);
            console.log(logEntry);
            updateLogDisplay();
        }
        
        function updateLogDisplay() {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = eventLog.slice(-50).join('<br>');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(connected) {
            const statusDiv = document.getElementById('status');
            if (connected) {
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'Conectado';
            } else {
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'Desconectado';
            }
        }
        
        function clearLog() {
            eventLog = [];
            updateLogDisplay();
        }
        
        // Monitorar eventos de visibilidade
        document.addEventListener('visibilitychange', () => {
            addLog(`Visibilidade da aba mudou: ${document.hidden ? 'oculta' : 'visível'}`);
        });
        
        window.addEventListener('focus', () => {
            addLog('Janela ganhou foco');
        });
        
        window.addEventListener('blur', () => {
            addLog('Janela perdeu foco');
        });
        
        window.addEventListener('online', () => {
            addLog('Internet reconectada');
        });
        
        window.addEventListener('offline', () => {
            addLog('Internet desconectada');
        });
        
        // Funções de teste
        function testConnect() {
            addLog('Tentando conectar...');
            // Aqui você chamaria webSocketService.connect()
            window.location.href = 'http://localhost:8081';
        }
        
        function testDisconnect() {
            addLog('Desconectando...');
            // Aqui você chamaria webSocketService.disconnect()
        }
        
        function testSendMessage() {
            addLog('Enviando mensagem de teste...');
            // Aqui você chamaria webSocketService.sendMessage()
        }
        
        // Inicializar
        addLog('Página carregada - pronta para testes');
        addLog('Abra o console do navegador para ver logs detalhados do WebSocket');
    </script>
</body>
</html>